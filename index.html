<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>JCJ</title>
  <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
</head>
<body>
<script>
  const LIFF_ID = "2008851980-yhGytJRd";

  function getSpot() {
    const q = new URLSearchParams(location.search);
    const direct = (q.get("spot") || "").trim();
    if (direct) return direct;

    const stateRaw = q.get("liff.state");
    if (stateRaw) {
      let decoded = stateRaw;
      try { decoded = decodeURIComponent(stateRaw); } catch(e){}
      const s = decoded.startsWith("?") ? decoded.slice(1) : decoded;
      return (new URLSearchParams(s).get("spot") || "").trim();
    }
    return "";
  }

  async function main() {
    await liff.init({ liffId: LIFF_ID });
    if (!liff.isLoggedIn()) return liff.login({ redirectUri: location.href });

    const spot = getSpot();
    if (!spot) return;

    await liff.sendMessages([{ type:"text", text:`#${spot}` }]);
    liff.closeWindow(); // 送ったら閉じる
  }

  main().catch(()=>{});
</script>
</body>
</html>
